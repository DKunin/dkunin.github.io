<!DOCTYPE html>
<html>
  <head>
    <title>Lint Yourself</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta property="og:title" content="Lint Yourself" />
    <meta property="og:site_name" content="DKunin:presentation" />
    <meta property="og:url" content="{{ page.url | absolute_url }}" />
    <meta property="og:description" content="Когда вы работаете в большой и/или распределенной команде - следить за качеством кода становится только сложнее. Тогда на помощь и приходят они - Линтеры. В докладе мы рассмотрим, что же это за зверь такой, линтер, какие они бывают, как и когда они должны работать и разберем как расширить существующий или написать свой собственный линтер." />
    <meta property="og:type" content="article" />
    <link rel="stylesheet" href="../css/styles.css">
  </head>
  <style>
    body, html {
      font-family: 'Source Sans Pro', 'Helvetica Neue', 'Lucida Grande', Arial, sans-serif;
    }
    .row {
      display: flex;
      justify-content: space-around;
    }

    .column {
      text-align: left;
    }

    .central-column {
      width: 800px;
      text-align: left;
      display: inline-block;
    }
  </style>
  <body>
    <textarea id="source">
      class: center, middle

      ## Lint Yourself

      ---
      class: center, middle
      ## Кто я такой

      Дима Кунин, Tech unit Lead Trust&Safety Avito

      ---

      ## О чем я расскажу
      
      - Что делает линтер
      - Какую он приносит пользу
      - Как работает линтер
      - Как написать собственные правила для esLint
      - Как написать собственный кастомный линтер
      - Как встроить его во флоу

      ---

      ## Что делает линтер

      ???

      Линтер запускается перед тестами, приводит к единому своду правил

      ---

      ## Разница юнит тестов и линтеров

      - Т: Проверяют параметры на входе/выходе
      - Л: Проверяют исходный код

      ???

      Линтеры и тесты не исключают, а дополняют друг-друга
      ---

      ## В чем преимущества линтинга

      - Общие стили для распределенных команд (код пишет "один" человек)
      - Меньше ошибок
      - Возможность кастомизации линтеров

      ---

      ## Популярные линтеры
      - Eslint (Standart)
      - TsLint
      - stylelint
      - webhint.io

      ---

      ## Процесс Линтинга

      - Исходный код
      - Парсер AST (https://github.com/acornjs/acorn, https://github.com/jquery/esprima)
      - Анализатор
      - Список ошибок
      - (Опционально) Fix

      ---
      <pre>
      <code>
        > var esprima = require('esprima');
        > var program = 'const answer = 42';

        > esprima.tokenize(program);
        [ { type: 'Keyword', value: 'const' },
          { type: 'Identifier', value: 'answer' },
          { type: 'Punctuator', value: '=' },
          { type: 'Numeric', value: '42' } ]
          
        > esprima.parseScript(program);
        { type: 'Program',
          body:
           [ { type: 'VariableDeclaration',
               declarations: [Object],
               kind: 'const' } ],
          sourceType: 'script' }
      </code>
      </pre>

      ---

      ## Разработка кастомного правила для eslint
      - Приставка js после querySelectorA

      ---

      ## Кастомный плагин для tslint
<pre><code>
  import * as ts from "typescript";
import * as Lint from "tslint";

export class Rule extends Lint.Rules.AbstractRule {
    public static FAILURE_STRING = "import statement forbidden";

    public apply(sourceFile: ts.SourceFile): Lint.RuleFailure[] {
        return this.applyWithWalker(new NoImportsWalker(sourceFile, this.getOptions()));
    }
}

// The walker takes care of all the work.
class NoImportsWalker extends Lint.RuleWalker {
    public visitImportDeclaration(node: ts.ImportDeclaration) {
        // create a failure at the current position
        this.addFailure(this.createFailure(node.getStart(), node.getWidth(), Rule.FAILURE_STRING));

        // call the base version of this visitor to actually parse this node
        super.visitImportDeclaration(node);
    }
}
</code></pre>


      ---

      ## Кастомный плагин для stylelint
      
      ---

      ## Кастомный плагин для webhint

<pre><code>
import * as ts from "typescript";
import * as Lint from "tslint";

export class Rule extends Lint.Rules.AbstractRule {
  public static FAILURE_STRING = "import statement forbidden";

  public apply(sourceFile: ts.SourceFile): Lint.RuleFailure[] {
      return this.applyWithWalker(new NoImportsWalker(sourceFile, this.getOptions()));
  }
}

// The walker takes care of all the work.
class NoImportsWalker extends Lint.RuleWalker {
  public visitImportDeclaration(node: ts.ImportDeclaration) {
      // create a failure at the current position
      this.addFailure(this.createFailure(node.getStart(), node.getWidth(), Rule.FAILURE_STRING));

      // call the base version of this visitor to actually parse this node
      super.visitImportDeclaration(node);
  }
}
</code></pre>

      ---

      ## Как разработать кастомный линтер
      - https://github.com/SAP/chevrotain

      ---
      ## AST = :power:
      - Имея Абстрактное синтаксическое дерево - вы можете все что угодно

      ---

      ## Демо
      - Пример собственного линтера для системы слайдов Remark

      ---

      ## Как встроить его во флоу
      - при сохранении
      - при коммите/пуше
      - CI-step

      ---
      class: center, middle, nopages
      # Вопросы?

      .blue[dkun.in]

      .blue[@DKunin]


    </textarea>
    <script src="../js/remark-latest.min.js"></script>
    <script>
      const slideshow = remark.create({ highlightLanguage: 'javascript' });
    </script>
  </body>
</html>